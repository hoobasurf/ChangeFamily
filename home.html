<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Timeline</title>
<link rel="stylesheet" href="style.css">
</head>
<body style="flex-direction: column;">

<h2>Timeline</h2>

<div class="timeline" id="timeline"></div>

<input type="file" id="fileInput" accept="image/*" hidden>
<button class="upload-btn" onclick="fileInput.click()">Prendre / Choisir une photo</button>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getStorage, ref, uploadBytes, getDownloadURL, listAll } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-storage.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyCVl5ktUmuiVeMtYUHtxORytkeu71_XBF0",
  authDomain: "changefamilysnap.firebaseapp.com",
  projectId: "changefamilysnap",
  storageBucket: "changefamilysnap.firebasestorage.app",
  messagingSenderId: "335835110495",
  appId: "1:335835110495:web:13194c4bd4579d4f434fea",
  measurementId: "G-8D5PC0EZ74"
};

const app = initializeApp(firebaseConfig);
const storage = getStorage(app);
const auth = getAuth(app);

onAuthStateChanged(auth, user => {
  if (!user) location.href = "index.html";
});

const timeline = document.getElementById("timeline");

const loadImages = async () => {
  timeline.innerHTML = "";
  const list = await listAll(ref(storage, "uploads/"));
  list.items.forEach(async item => {
    const url = await getDownloadURL(item);
    timeline.innerHTML += `<img src="${url}">`;
  });
}

fileInput.addEventListener("change", async (e) => {
  const file = e.target.files[0];
  const storageRef = ref(storage, "uploads/" + Date.now());
  await uploadBytes(storageRef, file);
  loadImages();
});

loadImages();

window.addEventListener("load", () => {
  document.body.style.opacity = "1";
});
</script>

</body>
</html>
